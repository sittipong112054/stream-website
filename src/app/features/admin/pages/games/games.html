<section class="admin-games">
  <div class="card">
    <div class="card-head">
      <h2>Games Catalog ({{ filtered().length }})</h2>
      <div class="actions">
        <input
          type="text"
          placeholder="Search..."
          (input)="q.set($any($event.target).value)"
        />
        <button class="add" (click)="openCreate()">+ Add Game</button>
      </div>
    </div>

    <table>
      <thead>
        <tr>
          <th>Image</th>
          <th>Title</th>
          <th>Category</th>
          <th>Price</th>
          <th>Status</th>
          <th>Release Date</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let g of filtered()">
          <td>
            <img
              [src]="g.imageUrl || '/assets/placeholder-wide.jpg'"
              style="cursor: pointer"
            />
          </td>
          <td>
            <a>{{ g.title }}</a>
          </td>
          <td>{{ g.categoryName || "-" }}</td>
          <td class="price">‡∏ø {{ g.price | number : "1.2-2" }}</td>
          <td>
            <span
              class="status"
              [class.active]="g.status === 'ACTIVE'"
              [class.inactive]="g.status === 'INACTIVE'"
            >
              {{ g.status }}
            </span>
          </td>
          <td>
            {{ g.releaseDate || (g.releasedAt | date : "dd MMM yyyy") }}
          </td>

          <td class="actions">
            <button class="view" (click)="openDetails(g.id)">üëÅÔ∏è</button>
            <button class="edit" (click)="openEdit(g)">‚úèÔ∏è</button>
            <button class="delete" (click)="delete(g.id)">üóëÔ∏è</button>
          </td>
        </tr>
      </tbody>
    </table>

    <div
      class="details-backdrop"
      *ngIf="detailsOpen()"
      (click)="closeDetails()"
    ></div>

    <aside class="details-panel" [class.open]="detailsOpen()">
      <div class="head">
        <h3>Game Details</h3>
        <button class="close" (click)="closeDetails()">‚úï</button>
      </div>

      <div class="body" *ngIf="!detailsLoading(); else loadingTpl">
        <ng-container *ngIf="selected() as s">
          <div class="cover">
            <img
              [src]="s.imageUrl || '/assets/placeholder-wide.jpg'"
              alt="cover"
            />
          </div>

          <div class="row">
            <span class="label">Title</span>
            <span class="value">{{ s.title }}</span>
          </div>

          <div class="row">
            <span class="label">Category</span>
            <span class="value"
              >{{ s.categoryName }} (ID {{ s.categoryId }})</span
            >
          </div>

          <div class="row">
            <span class="label">Price</span>
            <span class="value">‡∏ø {{ s.price | number : "1.2-2" }}</span>
          </div>

          <div class="row">
            <span class="label">Status</span>
            <span class="value">
              <span
                class="status"
                [class.active]="s.status === 'ACTIVE'"
                [class.inactive]="s.status === 'INACTIVE'"
              >
                {{ s.status }}
              </span>
            </span>
          </div>

          <div class="row">
            <span class="label">Released</span>
            <span class="value">
              {{
                s.releaseDate || (s.releasedAt | date : "dd MMM yyyy, HH:mm")
              }}
            </span>
          </div>

          <div class="desc" *ngIf="s.description">
            <div class="label">Description</div>
            <p>{{ s.description }}</p>
          </div>

          <div class="panel-actions">
            <button class="outline" (click)="openEdit(s)">Edit</button>
            <button class="danger" (click)="delete(s.id)">Delete</button>
          </div>
        </ng-container>
      </div>

      <ng-template #loadingTpl>
        <div class="loading">Loading...</div>
      </ng-template>
    </aside>
  </div>

  <div class="modal" *ngIf="showModal()">
    <div class="dialog">
      <h3>{{ editingId() == null ? "Add Game" : "Edit Game" }}</h3>

      <form (submit)="save(); $event.preventDefault()">
        <label>Title</label>
        <input
          type="text"
          [value]="form.title()"
          (input)="form.title.set($any($event.target).value)"
          required
        />

        <label>Category</label>
        <select
          [value]="form.categoryId()"
          (change)="form.categoryId.set(+$any($event.target).value)"
        >
          <option *ngFor="let c of categories()" [value]="c.id">
            {{ c.name }}
          </option>
        </select>

        <label>Price</label>
        <input
          type="number"
          step="0.01"
          [value]="form.price()"
          (input)="form.price.set(+$any($event.target).value)"
          required
        />

        <label>Description</label>
        <textarea
          rows="3"
          [value]="form.description()"
          (input)="form.description.set($any($event.target).value)"
        ></textarea>

        <label>Release Date</label>
        <input
          type="date"
          [value]="form.releasedAt()"
          (input)="form.releasedAt.set($any($event.target).value)"
        />

        <label>Cover Image</label>
        <input type="file" accept="image/*" (change)="onPickFile($event)" />

        <div class="modal-actions">
          <button type="button" class="outline" (click)="showModal.set(false)">
            Cancel
          </button>
          <button type="submit" class="add">Save</button>
        </div>
      </form>
    </div>
  </div>
</section>
